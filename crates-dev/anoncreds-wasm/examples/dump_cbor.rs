use anoncreds::data_types::cred_def::CredentialDefinition;
use anoncreds::data_types::cred_def::CredentialDefinitionId;
use anoncreds::data_types::rev_reg_def::RevocationRegistryDefinitionId;
use anoncreds::data_types::schema::Schema;
use anoncreds::data_types::schema::SchemaId;
use anoncreds::issuer;
use anoncreds::prover;
use anoncreds::tails::TailsFileWriter;
use anoncreds::types::Presentation;
use anoncreds::types::PresentationRequest;
use anoncreds::types::{CredentialRevocationConfig, PresentCredentials};
use anoncreds::verifier;
use serde_json::json;
use std::collections::{BTreeSet, HashMap};
use std::fs::File;
use std::io::Result;
use std::io::Write;

use serde::{Deserialize, Serialize};

use utils::*;
mod utils;

fn write_to_file(filename: &str, content: &str) -> Result<()> {
    let mut file = File::create(filename)?;
    file.write_all(content.as_bytes())?;
    Ok(())
}

#[derive(Serialize, Deserialize, Debug)]
struct VPTuble {
    presentation: Presentation,
    pres_request: PresentationRequest,
    schemas: HashMap<SchemaId, Schema>,
    cred_defs: HashMap<CredentialDefinitionId, CredentialDefinition>,
}

fn gen_vp() -> VPTuble {
    let json = r#"{"presentation":{"proof":{"proofs":[{"primary_proof":{"eq_proof":{"revealed_attrs":{"height":"175","name":"99262857098057710338306967609588410025648622308394250666849665532448612202874"},"a_prime":"94478466039084798428739017506632304887397429153688009747075455147014898628467997086364378890076911220279454782163717645050559947623328241025454004709986319144964907999719962968243141484330315613923561923786844916367397199951261449650966713083180866665802574778699575907647847461713685590771343097133438276723951030840304822697619679979063875291085282605949977740309576862652084851519022654256077895638254118393059369386146897143202195196191664840983652514988855625680145659447076666803199196081278583645582226175235166664595042739638815557438103344595988765682867428675798084011876014878105695265806886498225151936457","e":"40887053233154127247799731119769894739431840270843000309377093980749377165450416576211601571696968733079707796227545576896609579772309409","v":"988169203795479267136029195385060359366857716416106990739277685465238714994474410941537808361238721041386207825993866457043400396914800088478353174891180472856800923117841935141765694007855683820154073264884097625842402716951256157309068582629099771936387208301781261358889741616443248501334298893369253363574761495835038127199714283634979570945646303578622598260667774027425741694363896461456487856632133955807497495774804438098676243910135882189711152707464463988288288635459917106032181349900565397456995027796453161860768060432845919624994261417749797361246747427166740919117170986973992266041499808888068069295921026678838469686990471581715436201381416115007451413224981639370619095715488278340666294096899338423526819010604945118951056445392350962876400755969164206479155388275248955817175878859783378060438067488983214783122865941350999178755395613511147829420841871226936061533761457685771769020540433482793959787","m":{"age":"6578655104759273501838957912664008624515409405721892168670446168710528337161118325897866723876314664143112380325891239810314112534041991657243721788679191824750300840486290002198","master_secret":"5809098011255552810958210211070088581435449002879061456401289267846674868440661782735051592993250340956259903754389720260172529491627894562529239377866075548404668942482617462090","sex":"8039520755279165973092305679539921621362731100453579887063594870613591978339679342316706522311059441676730464772204036333412829814709238496330303673715216486508980069878445063685"},"m2":"581082338800617385744471194147970112951650011439844733183206234184006684423892039307056731533096033990543649802243642689903845492385534353016633047180788957508708359980042385694283536273285763265320463867662255384376687385207252181035901775784723833745831097217082353768120010605955946509579892943977657648634763013878929179065732557694644695046538849748083093467143126202638030273967215779521096712088742123989575315052824827700172679862242442867288702836294969931949454611711546162824933007146852966467139440495136010242439555695522735043987591838923454573503962268489321922200301545076499531247557618009212219819748969879499940033336663981564900528264245766246819014874720091022456511765606591863472595575420486398423524051520713"},"ge_proofs":[{"u":{"3":"10398291409836455044652435404119786757355882397372574368898564793088475560572687932006204910822401674146949788492220537635382810278666384753591201231794236916767407530143109146406","0":"7042306857655687305394695616749868508137176018803672539434928956278184508706798877768382437221068318002016894733381462285315584719509917100689642956014284938064348427124847472216","2":"7837912307303183402888954350555441520204334246274301691277196507755344810004453317070796304392519028773261411135596032602185235384394477757032209038491606012852801981497595314488","1":"9569933987732300757664035817237914083119578995081701563959793445049304995441106289547165920602426482122303597417564086119773027057781441924180544089803057463425947736460856045210"},"r":{"1":"1474872727462649790250350415078225397056732274029249693646971769714239523561479811461113227802670657060756680776846147385025233572585513311318500875710711497223163819663396153667502719359111443350228224795068576841852452166192141179134264162099300289341076428739441711766672449013390233053914383115131318254771762810905198904547147189101931694356406586591608551615817435609219753678055642404296711644287889545378650207774673240845618791700125204502090752623417403599115441954830757163809666991345009837513433692096423787277579586334069985671587257861173317558259289744817964985486229127342034596425982317584456474783986071975969101866432264589532643329342931807144017468667261117433488449020218523567141620843287362918","0":"726386474582731173322344958421269823173393166218276740269302749844615467502697602798834561482902766132718694599809755163906569739012324725137167643933509299742110580299751024209507695794530299364958519163550876228800486454923588880246625103117607543080831667107700036483250237325818407761318587359753240814276821735420795606388553095320268791050996826676541500982271209093744937480598650834242641884147074081492321711766433399021398405335009622418467486677744427524395724488351024631627114912378039094301198253738351731458652673226473588638129590085429554183759474769889171707008461012316070525108571309208523202902109354899488069624019119681891020293698723010487421127332155520222939891277612048052426502897636018920","DELTA":"1037171534983664718785569450585595369217353749149801628883933983534986736437765255988437638430376765443760999055570109602014937738369058001761117443953425101917353017326561969540514573744619368958313456995861042015625004290697865124792149111502835253612714041869310604187304040808195612585659533330070131142852186319895476103828072516451688266613771340227941166771522382908875784476555033534434375451469195927095877455123537453095034118649741886033671653150754041701399272540234859505743728745996343161396316716750055070601101665356047460833903941571727395198288629221975563886385992386432633790139691060887307269193894044524977079353402318087950497625094022167994588700327417147910786444524952130035632338345688605342","3":"691221679828920515756781508452135516384017537597630238746372150947211454824587075167197948804115822128312671460684335774257187198132499453082503391516092804725809548661618805651728531220532884493460768883711773660514036041174248598990674904161698636549898046697454191636043029466164927946092797374138138721072859802588341859117343022403998196095600108188843989834947113067915034170385502803533673118685852216166095145666216093844428400651553237721706710674147639059765992712812102697351691344199120561380839418459331299961116321490691204572412490434041949117138046492854657186842017148367479881611818746302713171692831381444922719722433384746144559046843987765462650629540500170497073422029642866251814662101695785054","2":"1245261201964900464689172771897695666243901545113545778471813576142428343300810144213743031271647009153704941931856874514929116925096320404981962828764082381161114162636992846139600934645675545492742372571472350948833155109348535441559864367981080226803267610501318790467058953973456650107747451834196900876799240568229944473914814543787671511391251068633260147025932819010198447689381890500480233207004427670680245138207293876767685239445058333977976032804033329259714652138089525681333557490086385974583476070237650069690468634816452890523605772346907190006223089119802608702902291130884890479217211873999923661194572925700060940323507616731352893668410710178738838487640794832584681319383694595451427176021316657063"},"mj":"6578655104759273501838957912664008624515409405721892168670446168710528337161118325897866723876314664143112380325891239810314112534041991657243721788679191824750300840486290002198","alpha":"47569891716429416650675463545976051910043602644854575187046926886932287209794377119488202562149498330025442508332774481799697660315053744926130006635524754767385671111381941835689212247036591576868567520096979033006299445662572907051134548496238503592838737609973185315762909848016004868722317756190792552027692065280079776910469192703279108596822296585996566017761142722244039277266358474517620638256566812030648276589324341791513449984683040460113256055131895545464809496391353495534428336123262013497885465608256983343542022205429440807810976574770679311298475109970280204920886598021801205320175964274720817616009034742644252853442318894106289902624398112122829033912081920530338366015262610415779432870703762221274837450414512562813422982957088085175970361325052714270082270793187109459694291932548082912990086331116337874855260536149","t":{"DELTA":"78810479857341706254613062598436846871466119264475239469795595558804236082387885340605865189608594433483247641427392695892988538190573552766836349044914809033898806849414392560864498495558776059313658534391581738954704165839785128037773079060534030158424234418082790539514422137563401288290127195506695530465161930071600587541504999048522263450938906809063301463874701355146049252338154932170327178143188043035265093863791551337131338407866272988485619686240497348924427948562164556616015496103236974288628500968728303046291538462209989771535645345546482740778591613955297406360548913375211284260220400449837477605526","3":"81839951780374665721497933229906692272263844855922146152644456305582147176239091907263063041516382869099103011837899113074915758617975039757182681400391271326324672554880087452206722715016424706481552458056921322777669526798383632551474162542256397457801865828048591919735484672734927211180670060761768919782974983017035677771706695583241698923428957337497864114635062515096914705370631226995080457304269677291305829234961911479763723043541918150074464863984750627511086430979643718034936074956657700872217964454011670544771443519660253119214230537958804602240241281963318341833450222565805976578017761498861776515943","2":"26557649619007412543024539730336647633583427194661758154667357163904486192383471850160163982735490255314848029289705747041269675262491970019164082345336865714621369954732209269767206020214402773386552433101172724259127855479988377409205394364829768613996188422428622082624995824546606237078570756199741364333634348008343626472838931512250559873355111847067444104706257056654307585108692124209683809039194059864742705982930045719112980457053315929242381593815115885595615827782801829895287564310164525875666438488905426967458134226165590828864447599225875798457673998442163673485750572304730112021425472446257659908155","1":"72543629228467370440027607165705051863798431024988158799468993219815046135882620371120840251315381774814642135797512884912158406426943694894051626300044248837960313225267321496508690081397076949302470757355789152663378968142093492007547729541898697610316339168255968739409233488747503085268074567299965227214977549336021828233271712950079194491792317087635287757477318280867513054431412559395714304871236684366142594793530562204537499512610879921051669460053698629874286929464396190315806555920229877166328314638290726623393880747065126932382801971926299304974771284917419793601595890496162002884882739466018399142233","0":"41951246124635110524254573931168939751684289230616905175237574671000329749264469010487908014602640539449665897449275361858123199042689099972388315456514770349195406600171000817777651700140793922724223092259720576004351141914566974834749573692441431569502929372292988778270545316009077588092478081753016176302092267069556721022788450231971551582415087987346653016838461987891047083525021742449705785408125471650846547291043083101352474618576871340068843967861782552655740341056299415121619163150085997058412551147981408518019752654343034029198842825970033258517764621848729052912351669662583836842058068325118524579044"},"predicate":{"attr_name":"age","p_type":"GE","value":18}}]},"non_revoc_proof":null}],"aggregated_proof":{"c_hash":"44079086505176491119151708077953161305871895442882401913329133138088404311412","c_list":[[2,236,105,226,154,165,237,183,31,13,58,145,70,158,198,72,63,64,139,215,137,6,149,2,157,29,52,51,35,221,164,40,138,101,244,57,117,254,12,124,149,141,249,178,149,155,199,133,202,19,29,187,176,214,181,16,251,12,205,73,222,41,164,180,91,15,54,128,153,226,163,57,86,207,146,79,200,221,22,240,78,117,102,2,46,70,98,122,106,123,82,224,120,76,31,76,202,162,107,5,91,174,14,189,221,79,205,122,106,254,141,88,100,123,21,189,223,239,90,135,196,14,207,173,103,205,44,104,6,150,21,130,242,13,152,18,249,89,142,8,168,87,134,40,95,90,35,83,87,209,106,134,243,253,22,242,225,159,215,151,152,7,18,115,161,16,228,57,157,59,84,147,190,22,165,169,228,247,136,98,147,141,146,252,141,8,174,181,127,174,144,225,183,140,44,35,4,165,137,243,147,50,19,235,117,7,186,220,234,230,141,163,221,90,229,150,227,253,44,23,12,252,10,192,213,42,194,102,125,150,90,162,127,204,3,101,239,13,133,3,254,234,56,14,241,34,56,120,234,186,175,13,51,147,170,7,201],[1,76,81,96,181,201,75,90,243,192,169,225,119,5,12,149,2,167,225,150,39,13,59,67,25,117,100,215,196,241,204,38,15,105,235,89,132,139,251,114,62,65,88,68,176,239,185,217,109,20,173,121,213,98,220,223,59,232,117,231,143,39,40,231,227,78,246,27,48,227,49,111,36,160,74,152,88,129,73,166,254,199,216,227,42,103,237,31,170,77,106,181,100,64,80,120,71,33,255,39,190,16,149,83,192,73,180,198,165,121,15,39,149,189,185,129,210,123,100,95,14,201,211,34,146,159,105,186,20,54,58,194,31,179,192,14,50,216,210,169,225,37,191,217,192,228,203,65,244,87,125,172,144,139,251,234,60,209,91,146,99,106,53,204,16,55,126,183,9,63,44,95,170,212,144,229,2,237,104,200,201,48,49,154,176,251,157,190,36,56,86,239,7,6,152,106,153,181,172,168,8,66,141,18,13,67,93,40,65,186,225,56,40,232,73,245,140,79,189,180,215,103,151,185,236,73,229,215,140,40,60,250,30,207,74,212,105,196,177,37,104,220,186,67,165,149,226,253,63,53,172,69,97,21,204,220,228],[2,62,167,255,28,199,239,75,176,255,19,20,197,176,46,255,52,245,144,147,96,96,57,204,99,46,224,15,64,121,33,214,147,235,141,23,218,65,189,52,120,145,52,196,133,220,106,157,197,143,217,49,68,0,144,19,104,115,251,166,187,34,248,84,214,73,148,208,98,83,211,124,231,238,199,124,158,184,154,205,30,20,253,167,160,72,66,240,95,159,171,232,199,194,214,205,206,190,118,58,109,40,114,137,223,94,187,194,187,244,249,121,121,2,144,29,60,97,253,59,55,42,115,71,116,184,155,93,84,189,114,190,65,10,83,119,60,85,205,121,234,211,171,197,116,222,79,50,21,108,49,37,41,242,152,100,13,145,115,191,100,206,32,103,215,0,76,244,121,247,81,197,48,101,76,141,53,247,71,114,24,117,243,221,122,182,27,234,213,2,152,252,103,23,85,132,114,197,197,123,214,85,22,78,84,129,197,128,27,29,9,84,192,100,215,85,158,18,190,250,97,94,147,154,207,216,46,224,203,123,213,113,87,242,71,235,181,197,17,33,183,37,161,131,234,179,162,178,156,220,117,194,94,143,47,65,89],[210,96,138,51,217,216,47,177,181,46,53,86,165,164,188,207,175,118,177,191,198,110,106,171,230,144,113,148,107,72,68,42,126,22,1,224,115,175,103,126,18,98,239,214,232,77,186,121,213,197,121,210,195,198,240,99,119,24,17,243,205,175,163,208,106,199,34,186,19,160,172,18,194,178,41,156,243,57,211,39,230,111,96,203,254,77,6,3,88,63,45,60,61,3,28,53,155,238,44,66,123,65,34,184,174,247,50,154,18,89,38,181,179,227,10,96,118,4,135,154,186,68,163,17,11,155,139,71,5,43,209,98,165,115,229,225,86,158,170,68,242,80,94,229,5,230,111,76,5,69,240,172,20,232,172,189,232,170,6,164,142,75,232,0,245,150,231,39,117,35,241,160,96,29,10,250,185,57,249,161,45,215,148,26,9,113,254,82,213,66,9,241,103,226,201,133,221,157,228,39,230,95,235,188,191,91,73,145,113,174,1,148,117,38,82,126,94,150,198,158,91,192,102,157,27,183,171,252,113,154,194,15,147,80,30,56,53,234,34,207,59,192,72,150,89,71,144,94,194,97,116,98,107,108,16,59],[2,136,76,27,153,196,90,241,33,68,117,166,183,128,159,199,229,44,86,55,192,111,95,248,98,157,41,186,211,134,27,88,66,245,15,247,248,37,201,183,114,141,163,133,106,176,158,121,41,186,153,226,161,188,170,126,239,42,254,29,99,213,37,89,15,154,72,255,149,151,118,125,170,90,244,207,218,6,166,112,204,20,220,27,79,190,98,68,203,193,116,179,9,134,111,90,179,203,139,88,72,66,131,255,45,146,156,90,205,83,17,130,207,148,46,62,3,133,144,238,154,21,214,118,54,15,82,247,39,45,14,130,185,226,55,186,128,209,26,78,165,77,177,51,201,3,139,147,166,213,49,162,8,57,27,148,99,117,109,1,187,1,94,161,122,201,18,138,175,110,105,158,188,44,186,3,55,87,117,61,115,188,41,147,119,247,82,30,33,233,55,187,174,94,115,69,140,82,5,212,45,0,2,197,32,224,109,210,117,58,117,0,102,181,152,246,146,181,111,105,202,153,12,163,181,171,141,116,246,25,202,219,153,16,99,103,118,26,233,166,6,101,160,78,142,168,193,59,203,195,252,244,163,123,241,179,103],[2,112,76,156,9,0,24,5,242,233,124,247,29,187,157,160,129,60,143,218,0,2,85,156,240,89,154,149,112,68,47,16,134,176,9,213,170,76,38,103,10,50,92,18,72,14,193,215,86,134,188,29,4,108,44,165,86,76,170,92,162,67,80,137,206,77,18,84,24,136,205,160,12,102,244,251,46,102,10,166,171,240,131,152,73,11,60,49,76,22,117,212,232,87,165,213,179,78,17,141,58,190,48,255,139,193,100,164,73,10,71,36,243,120,106,255,254,45,81,66,255,3,106,175,187,229,108,0,93,104,4,161,74,103,91,112,136,163,195,79,81,215,243,136,228,14,220,121,22,206,93,41,76,43,31,216,161,154,125,205,185,42,184,119,91,66,23,144,138,99,137,125,6,162,161,106,133,241,251,231,39,62,167,60,3,57,176,134,46,174,15,18,138,90,209,30,5,111,239,11,37,186,22,158,26,136,224,175,69,246,111,34,180,214,106,24,49,94,9,34,221,9,98,79,31,89,86,2,244,195,155,21,22,180,252,82,5,220,101,189,174,110,173,56,54,191,213,19,48,113,131,195,58,241,167,48,150]]}},"requested_proof":{"revealed_attrs":{"attr1_referent":{"sub_proof_index":0,"raw":"Alex","encoded":"99262857098057710338306967609588410025648622308394250666849665532448612202874"}},"revealed_attr_groups":{"attr4_referent":{"sub_proof_index":0,"values":{"height":{"raw":"175","encoded":"175"},"name":{"raw":"Alex","encoded":"99262857098057710338306967609588410025648622308394250666849665532448612202874"}}}},"self_attested_attrs":{"attr3_referent":"8-800-300"},"unrevealed_attrs":{"attr2_referent":{"sub_proof_index":0}},"predicates":{"predicate1_referent":{"sub_proof_index":0}}},"identifiers":[{"schema_id":"schema:government","cred_def_id":"creddef:government","rev_reg_id":null,"timestamp":null}]},"pres_request":{"name":"pres_req_1","non_revoked":null,"nonce":"325168928530492393294313","requested_attributes":{"attr1_referent":{"name":"name","non_revoked":null,"restrictions":null},"attr2_referent":{"name":"sex","non_revoked":null,"restrictions":null},"attr3_referent":{"name":"phone","non_revoked":null,"restrictions":null},"attr4_referent":{"names":["name","height"],"non_revoked":null,"restrictions":null}},"requested_predicates":{"predicate1_referent":{"name":"age","non_revoked":null,"p_type":">=","p_value":18,"restrictions":null}},"ver":"1.0","version":"0.1"},"schemas":{"schema:government":{"name":"Government Schema","version":"1.0","attrNames":["name","age","sex","height"],"issuerId":"issuer:id/path=bar"}},"cred_defs":{"creddef:government":{"schemaId":"schema:government","type":"CL","tag":"govermenttag","value":{"primary":{"n":"97596504327422107311724029576304760982385589104193704907891738676311956322731729097778848853560248186511499006779129532642119544673665954983063461204166093486838418029695624870619878892577466921245059022447295845525725868832153699335911826575940527565331275425396203470186901336154309860768775650174959909754738298683422143292565336679839434285109150662570221887635066193236820176557210802527448502851242620305906477340205004947864316390520094821141006811224229534322176811262518253658138057030175437579789020114825929071233736149842202587212551818679626293401243225727451917352384414859701295406425502355321286909893","s":"88772548394198269683966710891236628591610503039166389569676921048211083329076997628746830332998558572321183747606984919760095171215486273923489608547825313930618816530389661946049899767998508363032119101820576354608549338836096219919205122408492686439004595643557921319263555524231521344190862413587884486628401088990458860253967043686035266821760020711038706528602077709477696838779644869465426530838655569114417466871108800622034136602045277089968927471776284580362722094986743829726181671182152167993961287247297990105639735746787287908903881244133612346451570869360591769642533761508397861336231525856087700568000","r":{"name":"10523528980238917958085361406586533356795512734466321497452453794726845156916182814579608552444209434102109224329418149508153172422942499830424179625091609711807621550326652842355988500840686399911737049809003471463393970191202270640257942318958114199155331547309147893520128318068307429150053319759804079326926880582481067905767034381504897147048075098915261242139893409504125469226818246103100103518235271806356503329417681602537894610828984272678468660099423468459257386665506297999831979134303967670399330521910330297925528079396292943143392144828814329305781570541876687016666062038054368933218671097889681186745","age":"81201037366913448795536248915914474051901720688144868131430703653178333944164585927540002388386751544616534389616084483100668947160353368004728012278041539149689765857928275020927888425750680284103179865565431701802619294876631764611260062089559098134460517106152376197979563313319213199928460475608997935790480363689266862965814979872101951615105403444844191070653293307228833569771979207473375795300506353057443662830326033394810178774543680831173393289058681996529525080642774472172735253636220420310662202024249825366962021131979820650068184713872595057941620452298524935336300094798633494965606703990229237044141","height":"90113129218960515952278326797641969119979119797079844682933076288107902745171909474846721411134936185761970849812765346947345553737259154816777370850077197177114850176572982912953130838612146601022140071449469280934904651184817826827781596665631628126748106008885730737588215545506018336143952084214621909473249201285107398108772718675042983377991566623258106918280907394148156101822011948436055547479283761058442646563985709632683544132180352647156052071258260694520548709920807481418924981500972713419276130475002749635116170588775020829447646487242850500087773358560793443752476505281279851114693926828897909560942","master_secret":"61661456821386176401547093609730862290090266040137033307548137563679519360420242835229172716636182758987561723280255014487206311735759935445658299627295397986762484201063025232148725316831506794941138228662497635099210677110470312905615447667866862900968301813698664351905414650155098270486856930186262131126804672491323098716779378121661060475198236925713731627319687899139021484808902990191421073337959603563099622103912087500895269842678759327711898838894452122669410798415057852261013239692813247590880934420260146227922651924634303155873134595499360761303613170999836716175315217258484737272360971684236209968246","sex":"52814400236569699243048710625643391453122939978043695418850780226359234633534209915777358668093335163077483550757976632651746142341545509698151889553214812306086929076949024404507026634993054365052234677134828443650765927591992916838265131853318982415747478761426365391138799261594379166590594437847232757946585319745222767001081169673926754923497375179022486826537930605003625178282346124360839342696557660487838550381094678774199261025620189332835927789786469446867944654967323684934638682603916800885768481455574657147480392366348842554172835185562928178071923513759273731343710887001987385505669102424153065046139"},"rctxt":"89398903405723535419084872353344593098814901911729576032104684923450665440824525959065277546955021579472906779883272911029757221806737076940618811258609742609069529419551030026795497501677205620294249991686418045200557325975478272379439264936289058125329827737167456786668060632486600356464251368508531449682510540502961699107330366912664776669406681319110996380858796718181822798962472088565413570885890657239492562252503963426660472146953891680096294857178027146006296504686446357347223732684603225735529251688362106636121756990094308690523026526271389546735503425817446009313276330002822682690746435320725020296969","z":"28448714992967287956383290388200151867637736687550150577865387154629468200871476830731577762515102311736940418363595433776019805413634227154007309230883015298415281489942513122672488049456388944419027272720097559365811893301980085487082566699326766259299008718295883774750187798587613691692282868112525819674620366109583463729462387085139727072309684031124807691863983212298734330082700255829086425371613738403042352817303105735618797476987865900189433716758367715543213448799891134491332538556938561788212729625702417207752804341530000415265662662557864866050090363363864684033000995506524687704016193823715115444049"}},"issuerId":"issuer:id/path=bar"}}}"#;

    let v: VPTuble = serde_json::from_str(json).expect("Error deserializing VP");
    v
}

fn main() {
    let vp = gen_vp();
    let bytes = serde_cbor::to_vec(&vp).unwrap();
    let hex = hex::encode(&bytes);
    println!("{}", &hex);
    write_to_file("vp_cbor.hex", &hex).unwrap();
    let bytes = hex::decode(&hex).unwrap();
    let vp: VPTuble = serde_cbor::from_slice(&bytes).unwrap();

    // dbg!(&hex);

    // let bytes = hex::decode(&hex).unwrap();

    let valid = verifier::verify_presentation(
        &vp.presentation,
        &vp.pres_request,
        &vp.schemas,
        &vp.cred_defs,
        None,
        None,
        None,
    )
    .expect("Error verifying presentation");

    assert!(valid);
}
